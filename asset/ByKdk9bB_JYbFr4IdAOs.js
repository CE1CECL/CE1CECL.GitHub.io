var f=Object.defineProperty;var m=(u,t,e)=>t in u?f(u,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):u[t]=e;var p=(u,t,e)=>(m(u,typeof t!="symbol"?t+"":t,e),e);import{G as l}from"./BbvRrMjL3MsrffvEdAHV.js";import{L as w}from"./85yZmE5PqfcNKC64qTgv.js";class d{constructor(t){p(this,"logger",new w("REST"));p(this,"app");p(this,"headers");this.app=t,this.headers={"Access-Control-Allow-Origin":"*",Origin:"https://discord.com"}}setToken(t){t?this.headers.Authorization=t:delete this.headers.Authorization}static async getEndpointsFromDomain(t){try{return await this.getInstanceDomains(t,t)}catch{}const e=await fetch(`${t.origin}/.well-known/spacebar`).then(n=>n.json()).then(n=>new URL(n.api));return await this.getInstanceDomains(e,t)}static async getInstanceDomains(t,e){const n=await fetch(`${t.toString()}${t.pathname.includes("api")?"":"api"}/policies/instance/domains`).then(i=>i.json());return{api:n.apiEndpoint,gateway:n.gateway,cdn:n.cdn,wellknown:e.toString()}}static makeAPIUrl(t,e={}){const n=new URL(`${l.routeSettings.api}${t}`);return Object.entries(e).forEach(([i,o])=>{n.searchParams.append(i,o)}),n.toString()}static makeCDNUrl(t,e={}){const n=new URL(`${l.routeSettings.cdn}${t}`);return Object.entries(e).forEach(([i,o])=>{n.searchParams.append(i,o)}),n.toString()}async get(t,e={}){return new Promise((n,i)=>{const o=d.makeAPIUrl(t,e);return fetch(o,{method:"GET",headers:this.headers}).then(async a=>{var h;if(a.headers.get("content-length")!=="0")return(h=a.headers.get("content-type"))!=null&&h.includes("application/json")?a.ok?a.json():i(await a.json()):a.ok?a.text():i(a.json())}).then(n).catch(i)})}async post(t,e,n={},i={}){return new Promise((o,a)=>{const h=d.makeAPIUrl(t,n);return this.logger.debug(`POST ${h}; payload:`,e),fetch(h,{method:"POST",headers:{...i,...this.headers,"Content-Type":"application/json"},body:e?JSON.stringify(e):void 0}).then(async s=>{var r;if((r=s.headers.get("content-type"))!=null&&r.includes("application/json")){const c=await s.json();return s.ok?o(c):a(c)}if(s.headers.get("content-length")!=="0"){const c=await s.text();return s.ok?o(c):a(c)}return s.ok?o(s.status):a(s.statusText)}).catch(a)})}async put(t,e,n={},i={}){return new Promise((o,a)=>{const h=d.makeAPIUrl(t,n);return this.logger.debug(`PUT ${h}; payload:`,e),fetch(h,{method:"PUT",headers:{...i,...this.headers,"Content-Type":"application/json"},body:e?JSON.stringify(e):void 0}).then(async s=>{var r;if((r=s.headers.get("content-type"))!=null&&r.includes("application/json")){const c=await s.json();return s.ok?o(c):a(c)}if(s.headers.get("content-length")!=="0"){const c=await s.text();return s.ok?o(c):a(c)}return s.ok?o(s.status):a(s.statusText)}).catch(a)})}async postFormData(t,e,n={},i={},o){return new Promise((a,h)=>{const s=d.makeAPIUrl(t,n);this.logger.debug(`POST ${s}; payload:`,e);const r=new XMLHttpRequest;o&&(o.setAbortCallback(()=>{this.logger.debug("[PostFormData]: Message called abort"),r.abort(),h("aborted")}),r.upload.addEventListener("progress",c=>o.updateProgress(c))),r.addEventListener("loadend",()=>r.status>=200&&r.status<300?r.responseType==="json"?a(r.response):a(JSON.parse(r.response)):r.getResponseHeader("content-length")!=="0"?h(r.responseText):h(r.statusText)),r.open("POST",s),Object.entries({...i,...this.headers}).forEach(([c,g])=>{r.setRequestHeader(c,g)}),r.send(e)})}async delete(t,e={},n={}){return new Promise((i,o)=>{const a=d.makeAPIUrl(t,e);return this.logger.debug(`DELETE ${a}`),fetch(a,{method:"DELETE",headers:{...n,...this.headers}}).then(()=>i()).catch(o)})}}export{d as R};
//# sourceMappingURL=ByKdk9bB_JYbFr4IdAOs.js.map
