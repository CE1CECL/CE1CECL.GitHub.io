{"version":3,"file":"CkxoqqJTjehA-0RCPxTs.js","sources":["../../src/components/messaging/EmbedMedia.tsx"],"sourcesContent":["// adapted from Revite\n// https://github.com/revoltchat/revite/blob/master/src/components/common/messaging/embed/Embed.tsx\n\nimport { APIEmbed, EmbedType } from \"@spacebarchat/spacebar-api-types/v9\";\nimport { modalController } from \"../../controllers/modals\";\nimport Icon from \"../Icon\";\nimport styles from \"./Embed.module.css\";\n\ninterface Props {\n\tembed: APIEmbed;\n\twidth?: number;\n\theight?: number;\n\tthumbnail?: boolean;\n}\n\nfunction EmbedMedia({ embed, width, height, thumbnail }: Props) {\n\tswitch (embed.provider?.name) {\n\t\tcase \"YouTube\": {\n\t\t\tif (!embed.video?.url) return null;\n\t\t\tconst url = embed.video.url;\n\n\t\t\treturn <iframe loading=\"lazy\" src={url} allowFullScreen style={{ height }} />;\n\t\t}\n\t\tcase \"Spotify\": {\n\t\t\tconst url = embed.url;\n\t\t\tif (!url) break;\n\t\t\t// extract type and id from url\n\t\t\tconst match = url.match(/https:\\/\\/open\\.spotify\\.com\\/(track|album|playlist)\\/([a-zA-Z0-9]+)/);\n\t\t\tif (!match) break;\n\t\t\tconst type = match[1];\n\t\t\tconst id = match[2];\n\n\t\t\treturn (\n\t\t\t\t<iframe\n\t\t\t\t\tstyle={{ width: \"400px\", height: \"80px\", borderRadius: 12 }}\n\t\t\t\t\tsrc={`https://open.spotify.com/embed/${type}/${id}`}\n\t\t\t\t\tframeBorder=\"0\"\n\t\t\t\t\tallow=\"autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture\"\n\t\t\t\t\tloading=\"lazy\"\n\t\t\t\t></iframe>\n\t\t\t);\n\t\t}\n\t\tcase \"Soundcloud\":\n\t\t\treturn (\n\t\t\t\t<iframe\n\t\t\t\t\tsrc={`https://w.soundcloud.com/player/?url=${encodeURIComponent(\n\t\t\t\t\t\tembed.url!,\n\t\t\t\t\t)}&color=%23FF7F50&auto_play=false&hide_related=false&show_comments=true&show_user=true&show_reposts=false&show_teaser=true&visual=true`}\n\t\t\t\t\tframeBorder=\"0\"\n\t\t\t\t\tscrolling=\"no\"\n\t\t\t\t\tloading=\"lazy\"\n\t\t\t\t\tstyle={{ height }}\n\t\t\t\t/>\n\t\t\t);\n\t\t// not supported by the server\n\t\t// case \"Bandcamp\": {\n\t\t// \tconst url = embed.url;\n\t\t// \tif (!url) break;\n\t\t// \t// extract type and id from url\n\t\t// \tconst match = url.match(/https:\\/\\/([a-zA-Z0-9-]+)\\.bandcamp\\.com\\/(track|album|playlist)\\/([a-zA-Z0-9]+)/);\n\t\t// \tif (!match) break;\n\t\t// \tconst type = match[2];\n\t\t// \tconst id = match[3];\n\n\t\t// \treturn (\n\t\t// \t\t<iframe\n\t\t// \t\t\tsrc={`https://bandcamp.com/EmbeddedPlayer/${type.toLowerCase()}=${id}/size=large/bgcol=181a1b/linkcol=056cc4/tracklist=false/transparent=true/`}\n\t\t// \t\t\tseamless\n\t\t// \t\t\tloading=\"lazy\"\n\t\t// \t\t\tstyle={{ border: \"0\", height: \"42px\" }}\n\t\t// \t\t/>\n\t\t// \t);\n\t\t// }\n\t\tcase \"Streamable\": {\n\t\t\tconst url = embed.url;\n\t\t\tif (!url) break;\n\t\t\t// extract id from url\n\t\t\tconst match = url.match(/https:\\/\\/streamable\\.com\\/([a-zA-Z0-9]+)/);\n\t\t\tif (!match) break;\n\t\t\tconst id = match[1];\n\t\t\treturn (\n\t\t\t\t<iframe\n\t\t\t\t\tsrc={`https://streamable.com/e/${id}?quality=highest`}\n\t\t\t\t\tframeBorder=\"0\"\n\t\t\t\t\tallowFullScreen\n\t\t\t\t\tseamless\n\t\t\t\t\tloading=\"lazy\"\n\t\t\t\t\tstyle={{ height }}\n\t\t\t\t/>\n\t\t\t);\n\t\t}\n\t\tdefault: {\n\t\t\tif (embed.video && !thumbnail) {\n\t\t\t\tconst url = embed.video.url;\n\n\t\t\t\treturn (\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<video\n\t\t\t\t\t\t\tclassName={styles.embedImage}\n\t\t\t\t\t\t\tstyle={{ width, height }}\n\t\t\t\t\t\t\tsrc={url}\n\t\t\t\t\t\t\tloop={embed.type === EmbedType.GIFV}\n\t\t\t\t\t\t\tcontrols={embed.type !== EmbedType.GIFV}\n\t\t\t\t\t\t\tautoPlay={embed.type === EmbedType.GIFV}\n\t\t\t\t\t\t\tmuted={embed.type === EmbedType.GIFV ? true : undefined}\n\t\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\t\tmodalController.push({\n\t\t\t\t\t\t\t\t\ttype: \"image_viewer\",\n\t\t\t\t\t\t\t\t\tattachment: embed.video!,\n\t\t\t\t\t\t\t\t\tisVideo: true,\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t/>\n\n\t\t\t\t\t\t{embed.type === EmbedType.GIFV && (\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<div className={styles.embedGifIconBg}></div>\n\t\t\t\t\t\t\t\t<Icon icon=\"mdiFileGifBox\" size={1} className={styles.embedGifIcon} />\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\t\t\t\t);\n\t\t\t} else if (embed.image && !thumbnail) {\n\t\t\t\tconst url = embed.image.url;\n\n\t\t\t\treturn (\n\t\t\t\t\t<img\n\t\t\t\t\t\tclassName={styles.embedImage}\n\t\t\t\t\t\tsrc={url}\n\t\t\t\t\t\tloading=\"lazy\"\n\t\t\t\t\t\tstyle={{ width: \"100%\", height: \"100%\" }}\n\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\tmodalController.push({\n\t\t\t\t\t\t\t\ttype: \"image_viewer\",\n\t\t\t\t\t\t\t\tattachment: embed.image!,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}}\n\t\t\t\t\t/>\n\t\t\t\t);\n\t\t\t} else if (embed.thumbnail) {\n\t\t\t\tconst url = embed.thumbnail.url;\n\n\t\t\t\treturn (\n\t\t\t\t\t<img\n\t\t\t\t\t\tclassName={thumbnail ? styles.embedThumbnail : styles.embedImage}\n\t\t\t\t\t\tsrc={url}\n\t\t\t\t\t\tloading=\"lazy\"\n\t\t\t\t\t\tstyle={{ width, height }}\n\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\tmodalController.push({\n\t\t\t\t\t\t\t\ttype: \"image_viewer\",\n\t\t\t\t\t\t\t\tattachment: embed.thumbnail!,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}}\n\t\t\t\t\t/>\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}\n\n\treturn null;\n}\n\nexport default EmbedMedia;\n"],"names":["EmbedMedia","embed","width","height","thumbnail","_a","_b","url","jsx","match","type","id","styles","EmbedType","modalController","Icon"],"mappings":"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"}