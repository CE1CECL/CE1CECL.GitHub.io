{"version":3,"file":"D49Zv_qU5IVJqkf3el6R.js","sources":["../../src/components/messaging/MessageEmbed.tsx"],"sourcesContent":["// adapted from Revite\n// https://github.com/revoltchat/revite/blob/master/src/components/common/messaging/embed/Embed.tsx\n\nimport { APIEmbed, EmbedType } from \"@spacebarchat/spacebar-api-types/v9\";\nimport classNames from \"classnames\";\nimport React from \"react\";\nimport { decimalColorToHex } from \"../../utils/Utils\";\nimport Markdown from \"../markdown/Markdown\";\nimport MarkdownRenderer from \"../markdown/MarkdownRenderer\";\nimport styles from \"./Embed.module.css\";\nimport EmbedMedia from \"./EmbedMedia\";\nimport { MESSAGE_AREA_PADDING, MessageAreaWidthContext } from \"./MessageList\";\n\nconst MAX_EMBED_WIDTH = 300;\nconst MAX_EMBED_HEIGHT = 640;\nconst THUMBNAIL_MAX_WIDTH = 80;\nconst CONTAINER_PADDING = 24;\nconst MAX_PREVIEW_SIZE = 150;\nconst EMBEDDABLE_PROVIDERS = [\"Spotify\" /*, \"Bandcamp\"*/];\n\ninterface Props {\n\tembed: APIEmbed;\n}\n\nfunction MessageEmbed({ embed }: Props) {\n\tconst c = React.useContext(MessageAreaWidthContext);\n\tconst maxWidth = Math.min(c - MESSAGE_AREA_PADDING, MAX_EMBED_WIDTH);\n\n\tfunction calculateSize(w: number, h: number): { width: number; height: number } {\n\t\tconst limitingWidth = Math.min(w, maxWidth);\n\t\tconst limitingHeight = Math.min(MAX_EMBED_HEIGHT, h);\n\n\t\t// Calculate smallest possible WxH.\n\t\tconst width = Math.min(limitingWidth, limitingHeight * (w / h));\n\n\t\tconst height = Math.min(limitingHeight, limitingWidth * (h / w));\n\n\t\treturn { width, height };\n\t}\n\n\t// Determine special embed size.\n\tlet mw, mh;\n\tconst largeMedia =\n\t\tembed.provider?.name === \"GitHub\" ||\n\t\tembed.provider?.name === \"Streamable\" ||\n\t\tembed.type === EmbedType.Video ||\n\t\tembed.type === EmbedType.GIFV ||\n\t\tembed.type === EmbedType.Image;\n\n\tif (embed.image) {\n\t\tmw = embed.image?.width ?? MAX_EMBED_WIDTH;\n\t\tmh = embed.image?.height ?? 0;\n\t} else if (embed.thumbnail) {\n\t\tmw = embed.thumbnail.width ?? MAX_EMBED_WIDTH;\n\t\tmh = embed.thumbnail.height ?? 0;\n\t} else {\n\t\tswitch (embed.provider?.name) {\n\t\t\tcase \"YouTube\":\n\t\t\tcase \"Bandcamp\": {\n\t\t\t\tmw = embed.video?.width ?? 1280;\n\t\t\t\tmh = embed.video?.height ?? 720;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase \"Twitch\":\n\t\t\tcase \"Lightspeed\":\n\t\t\tcase \"Streamable\": {\n\t\t\t\tmw = 1280;\n\t\t\t\tmh = 720;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tdefault: {\n\t\t\t\tmw = MAX_EMBED_WIDTH;\n\t\t\t\tmh = 1;\n\t\t\t}\n\t\t}\n\t}\n\n\tconst { width, height } = calculateSize(mw, mh);\n\tif (\n\t\tembed.type === EmbedType.GIFV ||\n\t\tembed.type === EmbedType.Image ||\n\t\tembed.type === EmbedType.Video ||\n\t\tEMBEDDABLE_PROVIDERS.includes(embed.provider?.name ?? \"\")\n\t) {\n\t\treturn <EmbedMedia embed={embed} width={height} height={height} />;\n\t}\n\n\treturn (\n\t\t<div\n\t\t\tclassName={classNames(styles.embed, styles.website)}\n\t\t\tstyle={{\n\t\t\t\tborderInlineStartColor: embed.color ? decimalColorToHex(embed.color) : \"var(--background-tertiary)\",\n\t\t\t\tmaxWidth: width + CONTAINER_PADDING,\n\t\t\t}}\n\t\t>\n\t\t\t<div className={styles.embedGap}>\n\t\t\t\t<div style={{ display: \"flex\" }}>\n\t\t\t\t\t<div className={styles.embedGap}>\n\t\t\t\t\t\t{embed.type !== EmbedType.Rich && embed.provider && (\n\t\t\t\t\t\t\t<span className={styles.embedProvider}>{embed.provider.name}</span>\n\t\t\t\t\t\t)}\n\n\t\t\t\t\t\t{embed.author && (\n\t\t\t\t\t\t\t<div className={styles.embedAuthor}>\n\t\t\t\t\t\t\t\t{embed.author.icon_url && (\n\t\t\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\t\t\tloading=\"lazy\"\n\t\t\t\t\t\t\t\t\t\tclassName={styles.embedAuthorIcon}\n\t\t\t\t\t\t\t\t\t\tsrc={embed.author.icon_url}\n\t\t\t\t\t\t\t\t\t\tdraggable={false}\n\t\t\t\t\t\t\t\t\t\tonError={(e) => (e.currentTarget.style.display = \"none\")}\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t{embed.author.url ? (\n\t\t\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\t\t\thref={embed.url}\n\t\t\t\t\t\t\t\t\t\ttarget={\"_blank\"}\n\t\t\t\t\t\t\t\t\t\tclassName={classNames(styles.embedAuthorName, styles.embedAuthorNameLink)}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t{embed.author.name}\n\t\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t<span className={styles.embedAuthorName}>{embed.author.name}</span>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t)}\n\n\t\t\t\t\t\t{embed.title && (\n\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t{embed.url ? (\n\t\t\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\t\t\thref={embed.url}\n\t\t\t\t\t\t\t\t\t\ttarget={\"_blank\"}\n\t\t\t\t\t\t\t\t\t\tclassName={classNames(styles.embedTitle, styles.embedTitleLink)}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t{embed.title}\n\t\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t<span className={styles.embedTitle}>{embed.title}</span>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t)}\n\n\t\t\t\t\t\t{embed.description && (\n\t\t\t\t\t\t\t<div className={styles.embedDescription}>\n\t\t\t\t\t\t\t\t<MarkdownRenderer content={embed.description} />\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t)}\n\n\t\t\t\t\t\t{embed.fields && (\n\t\t\t\t\t\t\t<div className={styles.embedFields}>\n\t\t\t\t\t\t\t\t{embed.fields.map((field, i) => (\n\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\tkey={i}\n\t\t\t\t\t\t\t\t\t\tclassName={styles.embedField}\n\t\t\t\t\t\t\t\t\t\tstyle={{\n\t\t\t\t\t\t\t\t\t\t\t// inline = 1/7 for first, 7/14 for second\n\t\t\t\t\t\t\t\t\t\t\t// non-inline = 1/14\n\t\t\t\t\t\t\t\t\t\t\tgridColumn: field.inline ? (i % 2 === 0 ? \"1 / 7\" : \"7 / 13\") : \"1 / 13\",\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<div className={styles.embedFieldName}>{field.name}</div>\n\t\t\t\t\t\t\t\t\t\t<div className={styles.embedFieldValue}>\n\t\t\t\t\t\t\t\t\t\t\t<Markdown content={field.value} />\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{(!largeMedia || embed.type === EmbedType.Rich) && embed.thumbnail && (\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<EmbedMedia embed={embed} width={80} thumbnail />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\n\t\t\t\t{(largeMedia || embed.type === EmbedType.Rich) && (\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<EmbedMedia embed={embed} width={width} />\n\t\t\t\t\t</div>\n\t\t\t\t)}\n\n\t\t\t\t{embed.footer && (\n\t\t\t\t\t<div className={styles.embedFooter}>\n\t\t\t\t\t\t{embed.footer.icon_url && (\n\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\tloading=\"lazy\"\n\t\t\t\t\t\t\t\tclassName={styles.embedFooterIcon}\n\t\t\t\t\t\t\t\tsrc={embed.footer.icon_url}\n\t\t\t\t\t\t\t\tdraggable={false}\n\t\t\t\t\t\t\t\tonError={(e) => (e.currentTarget.style.display = \"none\")}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t)}\n\t\t\t\t\t\t<span className={styles.embedFooterText}>\n\t\t\t\t\t\t\t{embed.footer.text}\n\t\t\t\t\t\t\t{embed.timestamp && (\n\t\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t\t<span className={styles.embedFooterSeperator}>â€¢</span>\n\t\t\t\t\t\t\t\t\t{new Date(embed.timestamp).toLocaleString(undefined)}\n\t\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t)}\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n\nexport default MessageEmbed;\n"],"names":["MAX_EMBED_WIDTH","MAX_EMBED_HEIGHT","CONTAINER_PADDING","EMBEDDABLE_PROVIDERS","MessageEmbed","embed","c","React","MessageAreaWidthContext","maxWidth","MESSAGE_AREA_PADDING","calculateSize","w","h","limitingWidth","limitingHeight","width","height","mw","mh","largeMedia","_a","_b","EmbedType","_c","_d","_e","_f","_g","_h","jsx","EmbedMedia","classNames","styles","decimalColorToHex","jsxs","e","Fragment","MarkdownRenderer","field","i","Markdown"],"mappings":"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"}